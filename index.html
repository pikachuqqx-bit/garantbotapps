<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garant Bot</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000000;
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 100%;
            padding: 20px;
        }
        
        .screen {
            display: none;
        }
        
        .screen.active {
            display: block;
        }
        
        .logo {
            font-size: 3rem;
            margin-bottom: 20px;
            text-align: center;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .app-title {
            color: white;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .app-subtitle {
            color: #888;
            font-size: 14px;
            margin-bottom: 30px;
            text-align: center;
            line-height: 1.4;
        }
        
        .button-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .main-button {
            background: #1a1a1a;
            border: 2px solid #333;
            border-radius: 15px;
            padding: 18px;
            font-size: 16px;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 15px;
            text-align: left;
            width: 100%;
        }
        
        .main-button:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .button-create {
            border-color: #4CAF50;
        }
        
        .button-create:hover {
            border-color: #4CAF50;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
        }
        
        .button-profile {
            border-color: #2196F3;
        }
        
        .button-profile:hover {
            border-color: #2196F3;
            box-shadow: 0 8px 25px rgba(33, 150, 243, 0.3);
        }
        
        .button-withdraw {
            border-color: #FF9800;
        }
        
        .button-withdraw:hover {
            border-color: #FF9800;
            box-shadow: 0 8px 25px rgba(255, 152, 0, 0.3);
        }
        
        .button-icon {
            font-size: 22px;
            width: 35px;
            text-align: center;
        }
        
        .button-text {
            flex: 1;
        }
        
        .button-description {
            font-size: 12px;
            color: #888;
            margin-top: 3px;
            font-weight: normal;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #fff;
        }
        
        .form-input, .form-textarea {
            width: 100%;
            background: #1a1a1a;
            border: 2px solid #333;
            border-radius: 10px;
            padding: 12px 15px;
            color: white;
            font-size: 14px;
            resize: vertical;
        }
        
        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-textarea {
            min-height: 100px;
            font-family: inherit;
        }
        
        .currency-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .currency-button {
            background: #1a1a1a;
            border: 2px solid #333;
            border-radius: 10px;
            padding: 15px 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 14px;
        }
        
        .currency-button:hover, .currency-button.selected {
            border-color: #4CAF50;
            background: #2a2a2a;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }
        
        .btn-secondary {
            background: #333;
            color: white;
        }
        
        .btn-back {
            background: #666;
            color: white;
        }
        
        .btn-copy {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }
        
        .btn-share {
            background: linear-gradient(135deg, #FF9800, #F57C00);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .info-box {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .info-box.warning {
            border-color: #ff9800;
            background: #332900;
        }
        
        .info-box.success {
            border-color: #4CAF50;
            background: #1a331a;
        }
        
        .deal-preview {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .deal-item {
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }
        
        .deal-label {
            color: #888;
        }
        
        .deal-value {
            color: white;
            font-weight: 600;
        }
        
        .deal-link {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
            word-break: break-all;
            font-family: monospace;
            font-size: 12px;
            color: #4CAF50;
        }
        
        .copy-section {
            margin: 20px 0;
        }
        
        .share-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
        
        .hidden {
            display: none;
        }
        
        .status-message {
            background: #1a331a;
            border: 1px solid #4CAF50;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
            color: #4CAF50;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="mainScreen" class="screen active">
        <div class="container">
            <div class="logo">üõ°Ô∏è</div>
            <div class="app-title">GARANT BOT</div>
            <div class="app-subtitle">Secure Crypto Transactions</div>
            
            <div class="button-grid">
                <button class="main-button button-create" onclick="showCreateDealScreen()">
                    <span class="button-icon">üéÅ</span>
                    <div class="button-text">
                        Create Deal
                        <div class="button-description">Secure transaction with guarantor</div>
                    </div>
                </button>
                
                <button class="main-button button-profile" onclick="showProfile()">
                    <span class="button-icon">üë§</span>
                    <div class="button-text">
                        My Profile
                        <div class="button-description">Balance, rating and statistics</div>
                    </div>
                </button>
                
                <button class="main-button button-withdraw" onclick="withdrawFunds()">
                    <span class="button-icon">üí∏</span>
                    <div class="button-text">
                        Withdraw Funds
                        <div class="button-description">Withdraw to wallet or card</div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Å–æ–∑–¥–∞–Ω–∏—è —Å–¥–µ–ª–∫–∏ - –®–∞–≥ 1: –°—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ–¥–∞—Ä–∫–∏ -->
    <div id="createDealScreen" class="screen">
        <div class="container">
            <div class="logo">üéÅ</div>
            <div class="app-title">Create Safe Deal</div>
            <div class="app-subtitle">Step 1: Specify gift links</div>
            
            <div class="info-box">
                <strong>üìù Instructions:</strong><br>
                ‚Ä¢ Send one or multiple gift links<br>
                ‚Ä¢ Each link on a new line<br>
                ‚Ä¢ Formats: https://... or t.me/...<br><br>
                <strong>Example:</strong><br>
                <code>t.me/nft/PlushPepe-1</code><br>
                <code>t.me/nft/PlushPepe-2</code>
            </div>
            
            <div class="form-group">
                <label class="form-label">Gift Links:</label>
                <textarea 
                    class="form-textarea" 
                    id="giftLinks" 
                    placeholder="Enter gift links here, each on a new line..."
                ></textarea>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-back" onclick="showMainScreen()">Back</button>
                <button class="btn btn-primary" onclick="proceedToCurrency()">Continue</button>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Å–æ–∑–¥–∞–Ω–∏—è —Å–¥–µ–ª–∫–∏ - –®–∞–≥ 2: –í—ã–±–æ—Ä –≤–∞–ª—é—Ç—ã -->
    <div id="currencyScreen" class="screen">
        <div class="container">
            <div class="logo">üí∞</div>
            <div class="app-title">Select Currency</div>
            <div class="app-subtitle">Step 2: Choose deal currency</div>
            
            <div class="currency-grid">
                <button class="currency-button" onclick="selectCurrency('RUB')">üá∑üá∫ RUB</button>
                <button class="currency-button" onclick="selectCurrency('EUR')">üá™üá∫ EUR</button>
                <button class="currency-button" onclick="selectCurrency('UZS')">üá∫üáø UZS</button>
                <button class="currency-button" onclick="selectCurrency('KZT')">üá∞üáø KZT</button>
                <button class="currency-button" onclick="selectCurrency('KGS')">üá∞üá¨ KGS</button>
                <button class="currency-button" onclick="selectCurrency('IDR')">üáÆüá© IDR</button>
                <button class="currency-button" onclick="selectCurrency('UAH')">üá∫üá¶ UAH</button>
                <button class="currency-button" onclick="selectCurrency('BYN')">üáßüáæ BYN</button>
                <button class="currency-button" onclick="selectCurrency('TON')">üíé TON</button>
                <button class="currency-button" onclick="selectCurrency('STARS')">‚≠ê Stars</button>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-back" onclick="backToGiftLinks()">Back</button>
                <button class="btn btn-primary" id="continueCurrencyBtn" onclick="proceedToAmount()" disabled>Continue</button>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Å–æ–∑–¥–∞–Ω–∏—è —Å–¥–µ–ª–∫–∏ - –®–∞–≥ 3: –°—É–º–º–∞ -->
    <div id="amountScreen" class="screen">
        <div class="container">
            <div class="logo">üíµ</div>
            <div class="app-title">Deal Amount</div>
            <div class="app-subtitle">Step 3: Enter deal amount in <span id="currencyDisplay"></span></div>
            
            <div class="form-group">
                <label class="form-label">Amount:</label>
                <input 
                    type="number" 
                    class="form-input" 
                    id="dealAmount" 
                    placeholder="Enter amount (e.g., 1000)"
                    step="0.01"
                    min="0.01"
                >
            </div>
            
            <div class="info-box">
                <strong>üí° Note:</strong> Enter the amount in numbers only
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-back" onclick="backToCurrency()">Back</button>
                <button class="btn btn-primary" onclick="createDealFinal()">Create Deal</button>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å —Å—Å—ã–ª–∫–æ–π -->
    <div id="confirmScreen" class="screen">
        <div class="container">
            <div class="logo">üîó</div>
            <div class="app-title">Deal Created!</div>
            <div class="app-subtitle">Share this link with the buyer</div>
            
            <div class="deal-preview">
                <div class="deal-item">
                    <span class="deal-label">Gift Links:</span>
                    <span class="deal-value" id="previewLinks"></span>
                </div>
                <div class="deal-item">
                    <span class="deal-label">Currency:</span>
                    <span class="deal-value" id="previewCurrency"></span>
                </div>
                <div class="deal-item">
                    <span class="deal-label">Amount:</span>
                    <span class="deal-value" id="previewAmount"></span>
                </div>
            </div>
            
            <div class="info-box success">
                <strong>üéâ Deal Created Successfully!</strong><br>
                Share the link below with the buyer to start the secure transaction.
            </div>
            
            <div class="copy-section">
                <div class="deal-link" id="dealLink">Generating link...</div>
                <div class="share-buttons">
                    <button class="btn btn-copy" onclick="copyDealLink()">üìã Copy Link</button>
                    <button class="btn btn-share" onclick="shareDealLink()">üì§ Share</button>
                </div>
            </div>
            
            <div id="statusMessage" class="status-message" style="display: none;"></div>
            
            <div class="action-buttons">
                <button class="btn btn-back" onclick="showMainScreen()">Back to Main</button>
                <button class="btn btn-secondary" onclick="createAnotherDeal()">Create Another</button>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();
        tg.setHeaderColor('#000000');
        tg.setBackgroundColor('#000000');
        
        // –î–∞–Ω–Ω—ã–µ —Å–¥–µ–ª–∫–∏
        let dealData = {
            giftLinks: '',
            currency: '',
            amount: '',
            dealId: '',
            dealLink: ''
        };
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
        function showMainScreen() {
            hideAllScreens();
            document.getElementById('mainScreen').classList.add('active');
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω —Å–æ–∑–¥–∞–Ω–∏—è —Å–¥–µ–ª–∫–∏
        function showCreateDealScreen() {
            hideAllScreens();
            document.getElementById('createDealScreen').classList.add('active');
            document.getElementById('giftLinks').value = '';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –≤–∞–ª—é—Ç—ã
        function proceedToCurrency() {
            const giftLinks = document.getElementById('giftLinks').value.trim();
            if (!giftLinks) {
                alert('Please enter gift links');
                return;
            }
            
            dealData.giftLinks = giftLinks;
            hideAllScreens();
            document.getElementById('currencyScreen').classList.add('active');
            
            // –°–±—Ä–æ—Å –≤—ã–±–æ—Ä–∞ –≤–∞–ª—é—Ç—ã
            document.querySelectorAll('.currency-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.getElementById('continueCurrencyBtn').disabled = true;
        }
        
        // –í—ã–±–æ—Ä –≤–∞–ª—é—Ç—ã
        function selectCurrency(currency) {
            dealData.currency = currency;
            
            // –û–±–Ω–æ–≤–∏—Ç—å UI
            document.querySelectorAll('.currency-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
            document.getElementById('continueCurrencyBtn').disabled = false;
        }
        
        // –ü–µ—Ä–µ–π—Ç–∏ –∫ –≤–≤–æ–¥—É —Å—É–º–º—ã
        function proceedToAmount() {
            if (!dealData.currency) {
                alert('Please select currency');
                return;
            }
            
            hideAllScreens();
            document.getElementById('amountScreen').classList.add('active');
            document.getElementById('currencyDisplay').textContent = dealData.currency;
            document.getElementById('dealAmount').value = '';
        }
        
        // –°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É
        function createDealFinal() {
            const amount = parseFloat(document.getElementById('dealAmount').value);
            
            if (!amount || amount <= 0) {
                alert('Please enter a valid amount');
                return;
            }
            
            dealData.amount = amount;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å–¥–µ–ª–∫–∏
            dealData.dealId = generateDealId();
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            hideAllScreens();
            document.getElementById('confirmScreen').classList.add('active');
            
            // –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–µ–≤—å—é
            document.getElementById('previewLinks').textContent = 
                dealData.giftLinks.split('\n').slice(0, 2).join(', ') + 
                (dealData.giftLinks.split('\n').length > 2 ? '...' : '');
            document.getElementById('previewCurrency').textContent = dealData.currency;
            document.getElementById('previewAmount').textContent = amount + ' ' + dealData.currency;
            
            // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ —Å–¥–µ–ª–∫–µ
            createDealLink();
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID —Å–¥–µ–ª–∫–∏
        function generateDealId() {
            return 'webapp_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        function createDealLink() {
            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å—Å—ã–ª–∫—É
            const tempLink = `https://t.me/CrystalsFakeCheckBot?start=webapp_deal_${dealData.dealId}`;
            document.getElementById('dealLink').textContent = tempLink;
            dealData.dealLink = tempLink;
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç–∞
            sendDealToBot();
        }
        
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–¥–µ–ª–∫–∏ –≤ –±–æ—Ç–∞
        function sendDealToBot() {
            try {
                tg.sendData(JSON.stringify({
                    action: 'create_deal_full',
                    deal_id: dealData.dealId,
                    gift_links: dealData.giftLinks,
                    currency: dealData.currency,
                    amount: dealData.amount,
                    deal_link: dealData.dealLink,
                    timestamp: Date.now()
                }));
                
                showStatus('Deal data sent to bot successfully!');
                
            } catch (error) {
                console.error('Error sending deal data:', error);
                showStatus('Error sending deal data. Please try again.', true);
            }
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É —Å–¥–µ–ª–∫–∏
        function copyDealLink() {
            const linkElement = document.getElementById('dealLink');
            const linkText = linkElement.textContent;
            
            navigator.clipboard.writeText(linkText).then(() => {
                showStatus('Link copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                showStatus('Failed to copy link', true);
            });
        }
        
        // –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π
        function shareDealLink() {
            const linkText = document.getElementById('dealLink').textContent;
            const shareText = `Join our secure deal: ${linkText}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Secure Deal Invitation',
                    text: 'Join our secure deal',
                    url: linkText
                }).then(() => {
                    showStatus('Link shared successfully!');
                }).catch(err => {
                    console.error('Error sharing:', err);
                    copyDealLink(); // Fallback to copy
                });
            } else {
                copyDealLink(); // Fallback to copy
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å
        function showStatus(message, isError = false) {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = message;
            statusElement.style.color = isError ? '#ff4444' : '#4CAF50';
            statusElement.style.display = 'block';
            
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 3000);
        }
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞–∑–∞–¥
        function backToGiftLinks() {
            hideAllScreens();
            document.getElementById('createDealScreen').classList.add('active');
        }
        
        function backToCurrency() {
            hideAllScreens();
            document.getElementById('currencyScreen').classList.add('active');
        }
        
        // –°–æ–∑–¥–∞—Ç—å –µ—â–µ –æ–¥–Ω—É —Å–¥–µ–ª–∫—É
        function createAnotherDeal() {
            dealData = { giftLinks: '', currency: '', amount: '', dealId: '', dealLink: '' };
            showCreateDealScreen();
        }
        
        // –î—Ä—É–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function showProfile() {
            tg.sendData(JSON.stringify({
                action: 'show_profile',
                timestamp: Date.now()
            }));
            setTimeout(() => tg.close(), 500);
        }
        
        function withdrawFunds() {
            tg.sendData(JSON.stringify({
                action: 'withdraw_funds',
                timestamp: Date.now()
            }));
            setTimeout(() => tg.close(), 500);
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function hideAllScreens() {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            tg.BackButton.show();
            tg.BackButton.onClick(() => {
                if (document.getElementById('mainScreen').classList.contains('active')) {
                    tg.close();
                } else {
                    showMainScreen();
                }
            });
        });
    </script>
</body>
</html>
